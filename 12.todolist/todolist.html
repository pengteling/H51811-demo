<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>vue.js</title>
  <link rel="stylesheet" href="todo.css">
  <script src="https://unpkg.com/vue"></script>
</head>
<body>
  <div id="demo">
    <section class="todoapp">
      <header class="header">
        <h1>todos</h1>
        <input type="text" class="new-todo" placeholder="what needs to be done?" @keyup.enter="addTodo" ref="ipt">
      </header>

      <section class="main">
        <input id="toggle-all" type="checkbox" class="toggle-all" v-model="checkAll">
        <!-- label用来显示全选按钮 -->
        <label for="toggle-all"></label>
        <ul class="todo-list">
          <item 
            v-for="(todo,index) in todos" 
            :todo="todo" 
            :key="index"
            @delete-todo="deleteTodo"
          >
          </item>
        </ul>
      </section>

      <tabs :filter="filter"></tabs>
      
    </section>
  </div>

  <template id="item">
    <li :class="{editing: isEditing, completed:todo.isCompleted}">
      <div class="view">
        <input type="checkbox" v-model="todo.isCompleted" class="toggle">
        <label @dblclick="editTodo">{{ todo.content }}</label>
        <button class="destroy" @click="deleteTodo"></button>
      </div>
      <input 
        ref="iptEdit"
        type="text" 
        class="edit" 
        v-show="isEditing"
        v-model.lazy="todo.content"
        @keyup.enter="doneEdit"
        @blur="doneEdit"
        @keydown.esc="cancelEdit"
      >
    </li>
  </template>

  <template id="tabs">
    <footer class="footer">
      <span class="todo-count">
        <strong>4</strong>
        <span> </span>
        <span>item</span>
        <span> left</span>
      </span>
      <ul>
        <li
         v-for="state in states"  
         :key="state"       
        >
          <a :class="{'selected': state === filter}">
            {{ state }}
          </a>
          <span> </span>
        </li>
      </ul>
      <button>Clear Completed</button>

      

    </footer>
  </template>

  <script>
    Vue.component('Item',{
      template:'#item',
      props:['todo'],
      data(){
        return {
          isEditing:false,
          //cache:this.todo.content
        }
      },
      methods:{
        deleteTodo(){
          this.$emit('delete-todo',this.todo)
        },
        editTodo(){
          this.isEditing = true
          this.cache = this.todo.content
          this.$nextTick(()=>this.$refs.iptEdit.focus())          
        },
        doneEdit(){
          this.isEditing = false
        },
        cancelEdit(){
          //取消修改
          this.$refs.iptEdit.value = this.cache
          this.isEditing = false
          // setTimeout(()=>this.todo.content = this.cache,1000)
          // this.$nextTick(()=>this.todo.content= this.cache)
          
        }
      }
    })
    Vue.component('Tabs',{
      template:'#tabs',
      props:['filter'],
      data(){
        return {
          states:["All","Active","Completed"]
        }
      }
    })
    var vm = new Vue({
      el:'#demo',
      data:{
        todos:[
          {
            content:'写代码',
            isCompleted:false
          },
          {
            content:'吃饭',
            isCompleted:true
          },
        ],
        filter:'All'
      },
      computed:{
        checkAll:{
          get(){
            return this.todos.every(todo => todo.isCompleted)
          },
          set(val){
            this.todos.forEach(todo=> todo.isCompleted = val)
          }
        }
      },
      methods:{
        addTodo(e){
          this.todos.unshift({
            // content:e.target.value
            content: this.$refs.ipt.value,
            isCompleted: false
          })
          this.$refs.ipt.value = ''
        },
        deleteTodo(todo){
          this.todos.splice(this.todos.findIndex( item=>item === todo),1)
          // this.todos = this.todos.filter(item=>item !== todo)
        }
      }
    })
  </script>
</body>
</html>